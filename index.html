<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resonite World Link Utility</title>
</head>
<body>
  <pre id="js-disabled-notice">JS disabled! Please enable it for this utility to work.</pre>
  <script>
    const changeNotice = (message) => {
      document.getElementById('js-disabled-notice').textContent = message;
    }
    // Hide the JS disabled notice
    changeNotice('Redirecting...');

    // Extract sessionID from the current URL path
    const urlParams = new URLSearchParams(window.location.search);
    const sessionID = urlParams.get('sessionID');
    if (!sessionID) {
      const error = `No sessionID provided! Example: "${`${window.location}`.slice(0, -1)}?sessionID=S-U-h33tology:fitness`;
      changeNotice(error);
      throw new Error(error);
    }
    // send API request to Resonite to get lnl-net link
    const sessionDetails = await fetch(`https://api.resonite.com/sessions/${sessionID}`, { mode: 'no-cors' });
    // verify the existence and redirect to steam
    if (sessionDetails.status) {
      const error = `${sessionDetails.status} - ${sessionDetails.title}`;
      changeNotice(error);
      throw new Error(error);
    }
    const lnl = sessionDetails.sessionURLs[0];
    if (lnl) {
      window.location.href = `steam://rungameid/2519830//-Open ${encodeURIComponent(lnl)}`;
    } else {
      const error = 'Session doesn\'t have a lnl-net link. Can\'t join.';
      changeNotice(error);
      throw new Error(error);
    }
  </script>
</body>
</html>